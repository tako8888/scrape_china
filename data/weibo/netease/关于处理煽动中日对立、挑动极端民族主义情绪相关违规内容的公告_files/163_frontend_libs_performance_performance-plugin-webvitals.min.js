!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).performancePluginWebvitals={})}(this,(function(e){"use strict";var n,t,i,a,r=function(e,n){return{name:e,value:void 0===n?-1:n,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},o=function(e,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var t=new PerformanceObserver((function(e){return e.getEntries().map(n)}));return t.observe({type:e,buffered:!0}),t}}catch(e){}},c=function(e,n){var t=function t(i){"pagehide"!==i.type&&"hidden"!==document.visibilityState||(e(i),n&&(removeEventListener("visibilitychange",t,!0),removeEventListener("pagehide",t,!0)))};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},u=function(e){addEventListener("pageshow",(function(n){n.persisted&&e(n)}),!0)},f=function(e,n,t){var i;return function(a){n.value>=0&&(a||t)&&(n.delta=n.value-(i||0),(n.delta||void 0===i)&&(i=n.value,e(n)))}},s=-1,d=function(){return"hidden"===document.visibilityState?0:1/0},m=function(){c((function(e){var n=e.timeStamp;s=n}),!0)},v=function(){return s<0&&(s=d(),m(),u((function(){setTimeout((function(){s=d(),m()}),0)}))),{get firstHiddenTime(){return s}}},p=function(e,n){var t,i=v(),a=r("FCP"),c=function(e){"first-contentful-paint"===e.name&&(d&&d.disconnect(),e.startTime<i.firstHiddenTime&&(a.value=e.startTime,a.entries.push(e),t(!0)))},s=window.performance&&performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],d=s?null:o("paint",c);(s||d)&&(t=f(e,a,n),s&&c(s),u((function(i){a=r("FCP"),t=f(e,a,n),requestAnimationFrame((function(){requestAnimationFrame((function(){a.value=performance.now()-i.timeStamp,t(!0)}))}))})))},l=!1,y=-1,h={passive:!0,capture:!0},T=new Date,g=function(e,a){n||(n=a,t=e,i=new Date,S(removeEventListener),w())},w=function(){if(t>=0&&t<i-T){var e={entryType:"first-input",name:n.type,target:n.target,cancelable:n.cancelable,startTime:n.timeStamp,processingStart:n.timeStamp+t};a.forEach((function(n){n(e)})),a=[]}},E=function(e){if(e.cancelable){var n=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,n){var t=function(){g(e,n),a()},i=function(){a()},a=function(){removeEventListener("pointerup",t,h),removeEventListener("pointercancel",i,h)};addEventListener("pointerup",t,h),addEventListener("pointercancel",i,h)}(n,e):g(n,e)}},S=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(n){return e(n,E,h)}))},L={};var b,P,M,O,D=(b={},P=!1,M=!1,O=function(){var e;!P&&M&&(!b.TTFB||!b.DOMReady||b.DOMReady<=0?console.log("异常值!"):(P=!0,e=function(){window.NTESAntAnalysis.sendDataByBeacon({host:"vmonitor.ws.netease.com/web/vitals?param=",projectid:window.ntm.projectId,val_nm:"performance",val_act:"performance",info:{timing:b}})},window.NTESAntAnalysis?e():window.addEventListener("NTMReady",e)))},setTimeout((function(){window.PerformanceObserver&&window.PerformanceObserver.supportedEntryTypes&&window.PerformanceObserver.supportedEntryTypes.includes("layout-shift")?addEventListener("visibilitychange",(function e(){"hidden"===document.visibilityState&&(O(),removeEventListener("visibilitychange",e,!0))}),!0):addEventListener("pagehide",O,{capture:!0,once:!0})})),function(e){M||(M=!0),b[e.name]=Math.round(100*e.value)/100}),F=function(e,n){"complete"===document.readyState?R(e,n):window.addEventListener("load",(function(){return R(e,n)}))},R=function(e,n){setTimeout((function(){var t=A(),i={DOMReady:t.domContentLoadedEventEnd,pageLoad:t.loadEventEnd};e({name:n,value:i[n]})}),0)},A=function(){var e=window.performance.timing,n={entryType:"navigation",startTime:0},t=e.fetchStart||e.navigationStart;for(var i in e)"fetchStart"!==i&&"toJSON"!==i&&(n[i]=Math.max(e[i]-t,0));return n};e.getPerformanceMetric=function(){p(D),function(e,n){l||(p((function(e){y=e.value})),l=!0);var t,i=function(n){y>-1&&e(n)},a=r("CLS",0),s=0,d=[],m=function(e){if(!e.hadRecentInput){var n=d[0],i=d[d.length-1];s&&e.startTime-i.startTime<1e3&&e.startTime-n.startTime<5e3?(s+=e.value,d.push(e)):(s=e.value,d=[e]),s>a.value&&(a.value=s,a.entries=d,t())}},v=o("layout-shift",m);v&&(t=f(i,a,n),c((function(){v.takeRecords().map(m),t(!0)})),u((function(){s=0,y=-1,a=r("CLS",0),t=f(i,a,n)})))}(D),function(e,i){var s,d=v(),m=r("FID"),p=function(e){e.startTime<d.firstHiddenTime&&(m.value=e.processingStart-e.startTime,m.entries.push(e),s(!0))},l=o("first-input",p);s=f(e,m,i),l&&c((function(){l.takeRecords().map(p),l.disconnect()}),!0),l&&u((function(){var o;m=r("FID"),s=f(e,m,i),a=[],t=-1,n=null,S(addEventListener),o=p,a.push(o),w()}))}(D),function(e,n){var t,i=v(),a=r("LCP"),s=function(e){var n=e.startTime;n<i.firstHiddenTime&&(a.value=n,a.entries.push(e),t())},d=o("largest-contentful-paint",s);if(d){t=f(e,a,n);var m=function(){L[a.id]||(d.takeRecords().map(s),d.disconnect(),L[a.id]=!0,t(!0))};["keydown","click"].forEach((function(e){addEventListener(e,m,{once:!0,capture:!0})})),c(m,!0),u((function(i){a=r("LCP"),t=f(e,a,n),requestAnimationFrame((function(){requestAnimationFrame((function(){a.value=performance.now()-i.timeStamp,L[a.id]=!0,t(!0)}))}))}))}}(D),function(e){var n,t=r("TTFB");n=function(){try{var n=performance.getEntriesByType("navigation")[0]||function(){var e=performance.timing,n={entryType:"navigation",startTime:0};for(var t in e)"navigationStart"!==t&&"toJSON"!==t&&(n[t]=Math.max(e[t]-e.navigationStart,0));return n}();if(t.value=t.delta=n.responseStart,t.value<0||t.value>performance.now())return;t.entries=[n],e(t)}catch(e){}},"complete"===document.readyState?setTimeout(n,0):addEventListener("load",(function(){return setTimeout(n,0)}))}(D),F(D,"DOMReady"),F(D,"pageLoad")},Object.defineProperty(e,"__esModule",{value:!0})}));
